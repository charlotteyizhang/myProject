<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>VPIEC sandbox</title>
	<link rel="stylesheet" href="styles/main.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body>
	<div class="container">
		<div id="content" class="row"></div>
		<div class="row">
			<div class="col-md-4">
				<form>
					<div id="scriptForm-1">
						  <div class="form-group">
						    <label for="scriptName">Script Name:</label>
						    <input type="text" class="form-control" id="scriptName" placeholder="intro">
						  </div>

						  <div class="form-group">
						    <label for="videoName">Video Name:</label>
						    <input type="text" class="form-control" id="videoName" placeholder="video.mp3">
						  </div>

						  <div class="form-group">
						    <label for="frameRate">Frame rate:</label>
						    <input type="number" class="form-control" id="frameRate" placeholder="25">
						  </div>
					  
						  <div class="row">
							  <div class="form-group col-md-6">
							    <label for="start">Start:</label>
							    <input type="number" class="form-control" id="start" placeholder="0">
							  </div>
							  <div class="form-group col-md-6">
							    <label for="end">End:</label>
							    <input type="number" class="form-control" id="end" placeholder="3.2">
							  </div>
						  </div>

						  <div class="form-check"> <!--loop-->
						    <input type="checkbox" class="form-check-input" id="loop">
						    <label class="form-check-label" for="loop">loop</label>
						  </div>


						  <div class="form-check"> <!--hud-->
						    <input type="checkbox" class="form-check-input" id="hud">
						    <label class="form-check-label" for="hud">Hud</label>
						  </div>

						  <div class="form-check"> <!--loop-->
						    <input type="checkbox" class="form-check-input" id="interactions">
						    <label class="form-check-label" for="interactions">Interactions</label>
						  </div>


						   <div class="form-check"> <!--loop-->
						    <input type="checkbox" class="form-check-input" id="autoplay">
						    <label class="form-check-label" for="autoplay">Autoplay</label>
						  </div>

						  <div id="autoplayDetails" class="row" style="display: none">
							  <div class="form-group col-md-6">
							    <label for="after">waitingTime:</label>
							    <input type="text" class="form-control" id="after" placeholder="">
							  </div>
							  <div class="form-group col-md-6">
							    <label for="script">next script:</label>
							    <input type="text" class="form-control" id="script" placeholder="nextScript">
							  </div>
						  </div>


					</div>
				</form>
			</div>

			<div id="codingArea" class="col-md-8">
				<p class="display"></p>

				<button type="button" class="btn btn-primary" id="copyButton">Copy</button>
				<span id="msg"></span><br>
			</div>

			
		</div>
		
	</div>
	<script src="scripts/phaser.min.js"></script>
	<script src="scripts/game.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

	<script>
		let text = {};
		$(document).ready(function() {

			generateCode();

		    $('input.clear, input[type=reset]').on('click', function() {
		        $('input.input').val('').change();
		        $('p.display').text('The value of the text input is: ');
		    });
		    
		    $('input').on('keyup change', function() {
		    	generateCode();
		    });
		});

		function generateCode(){

			text.scriptText = '\'' + getText($('#scriptName')) + '\': { \n';
	    	text.videoName = '   video: \'' + getText($('#videoName')) + '\', \n';

	    	text.startTime = '   from: ' + getConvertedTime($('#start')) + ',\n';
	    	text.endTime = '   end: ' + getConvertedTime($('#end')) + ',\n';


	    	text.loop = '   loop: ' + $("#loop").is(":checked") + ',\n';

	    	if($('#hud').is(':checked')){
	    		text.hud = '   hud : [ \n';
	    		text.hud += '   ],\n';
	    	}


	    	if($('#interactions').is(':checked')){
	    		text.interactions = '   interactions : [ \n';
	    		text.interactions += '   ],\n';
	    	}

	    	if($('#autoplay').is(':checked')){
	    		$('#autoplayDetails').css('display', 'inline-flex');
	    		text.autoplay = '   autoplay : [ ';

	    		if($('#after').val()!=''){
	    			text.autoplay += ' after: ' + $('#after').val() + ',';
	    		}
	    		text.autoplay += ' script: \'' + getText($('#script')) + '\'';


	    		text.autoplay += '   ],\n';
	    	}

	       	updateP(text);

		}

		function getText(formName){
			return formName.val() != '' ? formName.val() : formName.attr('placeholder');
		}


		function getConvertedTime(formName){
			let time = getText(formName); 
			let frameRate = getText($('#frameRate'));
			let converted = parseInt(time) + (time - parseInt(time)) * 100 / frameRate;
			return converted.toFixed(2);
		}


	    function updateP( texts ) {
	    	let updatedText = '';
	    	for(var key in texts) {
	    		updatedText += texts[key];
	    	 
	    	}
	    	$('p.display').text('' + updatedText + '},');
	    }


		function download(text, name, type) {
			var jsonData = JSON.stringify(text);
			  var a = document.getElementById("a");
			  var file = new Blob([text], {type: type});
			  a.href = URL.createObjectURL(file);
			  a.download = name;
		}




		$("#copyButton").click(function() {
		    copyToClipboardMsg($('p.display'), "msg");
		});

		function copyToClipboardMsg(elem, msgElem) {
			var succeed = copyToClipboard(elem);
		    var msg;
		    if (!succeed) {
		        msg = "Copy not supported or blocked.  Press Ctrl+c to copy."
		    } else {
		        msg = "Text copied to the clipboard."
		    }
		    if (typeof msgElem === "string") {
		        msgElem = document.getElementById(msgElem);
		    }
		    msgElem.innerHTML = msg;
		    setTimeout(function() {
		        msgElem.innerHTML = "";
		    }, 2000);
		}

		function copyToClipboard(elem) {
			var selection = window.getSelection();
			var txt = $('p.display');
			var range = document.createRange();
			range.selectNodeContents(txt[0]);
			selection.removeAllRanges();
			selection.addRange(range); 
		    
		    // copy the selection
		    var succeed;
		    try {
		    	// $("p.display").select();
		    	succeed = document.execCommand("copy");
		    } catch(e) {
		        succeed = false;
		    }
		    return succeed;
		}
	</script>
</body>
</html>